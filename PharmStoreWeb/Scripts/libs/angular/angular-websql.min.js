"use strict";angular.module("angular-websql",[]).factory("$webSql",["$q",function(n){return{openDatabase:function(t,i,r,u){try{var f=openDatabase(t,i,r,u);if(typeof openDatabase=="undefined")throw"Browser does not support web sql";return{executeQuery:function(t,i){var r=n.defer();return f.transaction(function(n){n.executeSql(t,i,function(n,t){r.resolve(t)},function(n,t){console.log("There has been an error: "+t.message);r.reject()})}),r.promise},insert:function(n,t,i){var u=typeof i=="boolean"&&i?"INSERT OR REPLACE":"INSERT",r;u+=" INTO `{tableName}` ({fields}) VALUES({values});";var f="",e="",o=[];for(r in t)f+=Object.keys(t)[Object.keys(t).length-1]==r?"`"+r+"`":"`"+r+"`, ",e+=Object.keys(t)[Object.keys(t).length-1]==r?"?":"?, ",o.push(t[r]);return this.executeQuery(this.replace(u,{"{tableName}":n,"{fields}":f,"{values}":e}),o)},update:function(n,t,i){var f="",e=[],r,u;for(r in t)f+=Object.keys(t)[Object.keys(t).length-1]==r?"`"+r+"`= ?":"`"+r+"`= ?,",e.push(t[r]);return u=this.whereClause(i),this.executeQuery(this.replace("UPDATE `{tableName}` SET {update} WHERE {where}; ",{"{tableName}":n,"{update}":f,"{where}":u.w}),e.concat(u.p))},del:function(n,t){var r,i;return t?(r="DELETE FROM `{tableName}` WHERE {where}; ",i=this.whereClause(t)):(r="DELETE FROM `{tableName}`;",i={p:[]}),this.executeQuery(this.replace(r,{"{tableName}":n,"{where}":i.w}),i.p)},select:function(n,t){var i=this.whereClause(t);return this.executeQuery(this.replace("SELECT * FROM `{tableName}` WHERE {where};",{"{tableName}":n,"{where}":i.w}),i.p)},selectCustom:function(n,t,i,r,u){var e="SELECT "+(u?"DISTINCT ":"")+"Id, Title, Form, Manufacturer FROM `{tableName}` WHERE {where} LIMIT {limit} OFFSET {offset};",f=this.whereClause(t);return this.executeQuery(this.replace(e,{"{tableName}":n,"{where}":f.w,"{limit}":i,"{offset}":r}),f.p)},selectAll:function(n){return this.executeQuery("SELECT * FROM `"+n+"`; ",[])},whereClause:function(n){var r="",i=[];for(var t in n)typeof n[t]=="undefined"||typeof n[t]=="object"||typeof n[t]!="string"||n[t].match(/NULL/ig)?typeof n[t]!="undefined"&&typeof n[t]!="object"&&typeof n[t]=="number"?i.push(n[t]):typeof n[t].value=="undefined"||typeof n[t]!="object"||typeof n[t].value!="number"&&n[t].value.match(/NULL/ig)||i.push(n[t].value):i.push(n[t]),r+=typeof n[t]=="object"?typeof n[t].union=="undefined"?typeof n[t].value=="string"&&n[t].value.match(/NULL/ig)?"`"+t+"` "+n[t].value:typeof n[t].operator!="undefined"?"`"+t+"` "+n[t].operator+" ? ":"`"+t+"` = ?":typeof n[t].value=="string"&&n[t].value.match(/NULL/ig)?"`"+t+"` "+n[t].value+" "+n[t].union+" ":typeof n[t].operator!="undefined"?"`"+t+"` "+n[t].operator+" ? "+n[t].union+" ":"`"+t+"` = ? "+n[t].union+" ":typeof n[t]=="string"&&n[t].match(/NULL/ig)?"`"+t+"` "+n[t]:"`"+t+"` = ?";return{w:r,p:i}},replace:function(n,t){for(var i in t)n=n.replace(new RegExp(i,"ig"),t[i]);return n},createTable:function(n,t){var f="CREATE TABLE IF NOT EXISTS `{tableName}` ({fields}); ",h=[],r="",i,u,e,o,s;for(i in t){u="{type} {null}";r+="`"+i+"` ";typeof t[i]["null"]=="undefined"&&(t[i]["null"]="NULL");for(e in t[i])u=u.replace(new RegExp("{"+e+"}","ig"),t[i][e]);r+=u;typeof t[i]["default"]!="undefined"&&(r+=" DEFAULT "+t[i]["default"]);typeof t[i].primary!="undefined"&&(r+=" PRIMARY KEY");typeof t[i].auto_increment!="undefined"&&(r+=" AUTOINCREMENT");Object.keys(t)[Object.keys(t).length-1]!=i&&(r+=",");typeof t[i].primary!="undefined"&&t[i].primary&&h.push(i)}o={tableName:n,fields:r};for(s in o)f=f.replace(new RegExp("{"+s+"}","ig"),o[s]);return this.executeQuery(f,[])},dropTable:function(n){return this.executeQuery("DROP TABLE IF EXISTS `"+n+"`; ",[])}}}catch(e){console.error(e)}}}}]);